<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการเกียรติบัตรและผลงานนักเรียน</title>
    <link rel="icon" type="image/x-icon" href="assets/pk-logo-512.fw_.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#db2777',
                    }
                }
            }
        }
    </script>
    <script>
        // Theme Initialization
        if (localStorage.theme === 'dark') {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
            localStorage.theme = 'light';
        }

        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
            updateThemeIcons();
        }

        function updateThemeIcons() {
            const isDark = document.documentElement.classList.contains('dark');
            const icons = document.querySelectorAll('.theme-toggle-icon');
            icons.forEach(icon => {
                if (isDark) {
                    icon.setAttribute('data-lucide', 'sun');
                } else {
                    icon.setAttribute('data-lucide', 'moon');
                }
            });
            if (window.lucide) lucide.createIcons();
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body class="text-gray-800 dark:text-gray-200 min-h-screen flex flex-col items-center">

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none"></div>

    <!-- Navigation Drawer (Sidebar) -->
    <div id="nav-drawer" class="fixed inset-0 z-50 invisible md:hidden">
        <!-- Backdrop -->
        <div id="drawer-backdrop" class="absolute inset-0 bg-black/0 transition-colors duration-300"
            onclick="toggleDrawer()"></div>

        <!-- Drawer Content -->
        <div id="drawer-content"
            class="absolute inset-y-0 left-0 w-64 bg-white dark:bg-slate-900 shadow-xl flex flex-col transform -translate-x-full transition-transform duration-300 ease-in-out">
            <div class="p-6 border-b border-gray-100 dark:border-slate-800">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-lg font-bold text-gray-800 dark:text-white">เมนูหลัก</h2>
                    <button onclick="toggleDrawer()" aria-label="ปิดเมนู"
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <!-- User Info (shown when logged in) -->
                <div id="drawer-user-info" class="hidden">
                    <div onclick="switchView('my-awards'); toggleDrawer()"
                        class="flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-xl cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-900/50 transition">
                        <div class="w-9 h-9 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-sm"
                            id="drawer-user-avatar">?</div>
                        <div class="flex flex-col min-w-0">
                            <span class="text-sm font-bold text-gray-800 dark:text-white truncate"
                                id="drawer-user-name">-</span>
                            <span class="text-[11px] text-blue-600 dark:text-blue-400 font-medium"
                                id="drawer-user-role">-</span>
                        </div>
                        <i data-lucide="chevron-right" class="w-4 h-4 text-blue-400 ml-auto shrink-0"></i>
                    </div>
                </div>
            </div>

            <nav class="flex-grow p-4 space-y-2">
                <button onclick="switchView('dashboard'); toggleDrawer()"
                    class="w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 text-gray-600 dark:text-gray-400 transition">
                    <i data-lucide="trophy" class="w-5 h-5"></i>
                    <span>ผลงานทั้งหมด</span>
                </button>
                <button onclick="switchView('subject-summary'); toggleDrawer()"
                    class="w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 text-gray-600 dark:text-gray-400 transition">
                    <i data-lucide="pie-chart" class="w-5 h-5"></i>
                    <span>สรุปตามกลุ่มสาระฯ</span>
                </button>
                <button onclick="switchView('form'); toggleDrawer()"
                    class="w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 text-gray-600 dark:text-gray-400 transition">
                    <i data-lucide="plus-circle" class="w-5 h-5"></i>
                    <span>เพิ่มข้อมูลใหม่</span>
                </button>
                <button onclick="switchView('pending-rewards'); toggleDrawer()"
                    class="w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 text-gray-600 dark:text-gray-400 transition">
                    <i data-lucide="clock" class="w-5 h-5"></i>
                    <span>รางวัลรอรับ</span>
                </button>
                <button onclick="switchView('my-awards'); toggleDrawer()"
                    class="w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 text-gray-600 dark:text-gray-400 transition">
                    <i data-lucide="user-circle" class="w-5 h-5"></i>
                    <span>ผลงานของฉัน</span>
                </button>
            </nav>

        </div>
    </div>

    <!-- App Shell Container -->
    <!-- Responsive App Layout -->
    <div class="flex h-screen w-full bg-gray-50 overflow-hidden">

        <!-- Desktop Sidebar (Visible lg+) -->
        <aside
            class="hidden lg:flex w-72 bg-white dark:bg-slate-900 border-r border-gray-200 dark:border-slate-800 flex-col shrink-0 z-30 transition-colors duration-300">
            <!-- Sidebar Header -->
            <div class="h-20 flex items-center px-6 border-b border-gray-100 dark:border-slate-800 gap-3">
                <!-- TODO: Replace src with actual Pakkred School Logo URL -->
                <img src="assets/pk-logo-512.fw_.png" alt="โรงเรียนปากเกร็ด"
                    class="w-12 h-12 object-contain rounded-full shadow-sm border border-gray-100 dark:border-slate-700">
                <div class="flex flex-col justify-center">
                    <span
                        class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-0.5">โรงเรียนปากเกร็ด</span>
                    <h1 class="font-bold text-base text-blue-900 dark:text-blue-400 leading-tight">
                        ระบบจัดการเกียรติบัตร<br>และผลงานนักเรียน</h1>
                </div>
            </div>

            <!-- Sidebar Nav -->
            <nav class="p-4 space-y-1 overflow-y-auto flex-1">
                <button onclick="switchView('dashboard')" id="sidebar-dashboard"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition group">
                    <i data-lucide="trophy"
                        class="w-5 h-5 text-gray-400 dark:text-slate-600 group-hover:text-blue-600 dark:group-hover:text-blue-400"></i>
                    ผลงานทั้งหมด
                </button>
                <button onclick="switchView('subject-summary')" id="sidebar-subject"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition group">
                    <i data-lucide="pie-chart"
                        class="w-5 h-5 text-gray-400 dark:text-slate-600 group-hover:text-blue-600 dark:group-hover:text-blue-400"></i>
                    สรุปตามกลุ่มสาระฯ
                </button>
                <button onclick="switchView('form')" id="sidebar-form"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition group">
                    <i data-lucide="plus-circle"
                        class="w-5 h-5 text-gray-400 dark:text-slate-600 group-hover:text-blue-600 dark:group-hover:text-blue-400"></i>
                    เพิ่มข้อมูลใหม่
                </button>
                <button onclick="switchView('pending-rewards')" id="sidebar-pending"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition group">
                    <i data-lucide="clock"
                        class="w-5 h-5 text-gray-400 dark:text-slate-600 group-hover:text-blue-600 dark:group-hover:text-blue-400"></i>
                    รางวัลรอรับ
                </button>
                <button onclick="switchView('my-awards')" id="sidebar-my-awards"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition group">
                    <i data-lucide="user-circle"
                        class="w-5 h-5 text-gray-400 dark:text-slate-600 group-hover:text-blue-600 dark:group-hover:text-blue-400"></i>
                    ผลงานของฉัน
                </button>

                <!-- Desktop Subject Filters (Injected here when view is active) -->
                <div id="sidebar-filters"
                    class="hidden mt-6 pt-6 border-t border-gray-100 dark:border-slate-800 animate-in fade-in slide-in-from-left-4">
                    <p class="px-3 text-xs font-bold text-gray-400 dark:text-slate-500 uppercase tracking-wider mb-2">
                        กรองตามกลุ่มสาระ</p>
                    <div id="sidebar-filter-list" class="space-y-1">
                        <!-- Filters will be rendered here -->
                    </div>
                </div>
            </nav>

            <!-- Desktop User Info (Bottom) -->
            <div id="desktop-user-info" class="p-4 border-t border-gray-100 dark:border-slate-800">
                <!-- Injected by JS -->
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col h-full overflow-hidden relative">
            <!-- Mobile Header (Visible < lg) -->
            <header
                class="lg:hidden h-16 bg-white/95 backdrop-blur-sm border-b border-gray-200 dark:bg-slate-900/95 dark:border-slate-800 shrink-0 z-20 flex items-center justify-between px-4 sticky top-0 transition-colors duration-300">
                <div class="flex items-center gap-3">
                    <button onclick="toggleDrawer()" aria-label="เปิดเมนู"
                        class="p-2 -ml-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-800 transition">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <div class="flex items-center gap-2">
                        <!-- TODO: Replace src with actual Pakkred School Logo URL -->
                        <img src="assets/pk-logo-512.fw_.png" alt="PK Logo"
                            class="w-8 h-8 object-contain rounded-full border border-gray-100 dark:border-slate-700">
                        <span class="font-bold text-gray-800 dark:text-white text-sm">ระบบจัดการผลงานนักเรียน</span>
                    </div>
                </div>
                <div class="flex items-center gap-1">
                    <button onclick="toggleTheme()" aria-label="เปลี่ยนธีม"
                        class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 text-gray-600 dark:text-gray-300 transition">
                        <i data-lucide="moon" class="w-5 h-5 theme-toggle-icon"></i>
                    </button>
                    <!-- Mobile Auth Button -->
                    <div id="mobile-auth-section">
                        <button onclick="openModal('login-modal')" aria-label="เข้าสู่ระบบ"
                            class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 text-gray-600 dark:text-gray-300 transition">
                            <i data-lucide="log-in" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Desktop Header (Top Bar) -->
            <header
                class="hidden lg:flex h-16 bg-white border-b border-gray-200 dark:bg-slate-900 dark:border-slate-800 items-center justify-between px-8 transition-colors duration-300">
                <h2 class="font-bold text-lg text-gray-800 dark:text-white">ภาพรวมข้อมูล</h2>
                <div class="flex items-center gap-4">
                    <button onclick="toggleTheme()" aria-label="เปลี่ยนธีม"
                        class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 text-gray-600 dark:text-gray-300 transition">
                        <i data-lucide="moon" class="w-5 h-5 theme-toggle-icon"></i>
                    </button>
                    <!-- Login/User Section Placeholder -->
                    <div id="auth-section"></div>
                </div>
            </header>

            <!-- Scrollable Page Content -->
            <div id="main-scroll-container"
                class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth bg-gray-50 dark:bg-slate-950 transition-colors duration-300">
                <div class="w-full max-w-[1200px] mx-auto pb-24 space-y-6 min-h-full flex flex-col">

                    <!-- Sticky Header & Navigation Content -->


                    <!-- VIEW 1: DASHBOARD (Achievement Gallery) -->
                    <div id="view-dashboard" class="flex-grow p-4 space-y-4 fade-in">

                        <!-- Search & Filter -->
                        <div class="flex flex-col md:flex-row gap-3">
                            <div class="relative flex-grow">
                                <i data-lucide="search"
                                    class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-slate-500"></i>
                                <input type="text" id="search-input" oninput="handleSearch()"
                                    placeholder="ค้นหาชื่อนักเรียน, รายการ..."
                                    class="w-full pl-9 pr-4 py-2.5 bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 transition dark:text-white dark:placeholder-gray-500">
                            </div>
                            <!-- Sort Dropdown -->
                            <div class="relative w-full md:w-48">
                                <select id="sort-select" onchange="handleSort()"
                                    class="w-full appearance-none pl-3 pr-8 py-2.5 bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-xl text-sm text-gray-600 dark:text-gray-300 outline-none focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 transition cursor-pointer">
                                    <option value="latest">ล่าสุด (วันที่เพิ่ม)</option>
                                    <option value="rank">รางวัล</option>
                                    <option value="level">ระดับ</option>
                                </select>
                                <i data-lucide="chevron-down"
                                    class="absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-slate-500 pointer-events-none"></i>
                            </div>
                            <!-- Level Filter Dropdown -->
                            <div class="relative w-full md:w-48">
                                <select id="level-filter-select" onchange="handleLevelFilter()"
                                    class="w-full appearance-none pl-3 pr-8 py-2.5 bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-xl text-sm text-gray-600 dark:text-gray-300 outline-none focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 transition cursor-pointer">
                                    <option value="all">ทุกระดับ</option>
                                    <option value="นานาชาติ">ระดับนานาชาติ</option>
                                    <option value="ประเทศ">ระดับประเทศ</option>
                                    <option value="ภาค">ระดับภาค</option>
                                    <option value="จังหวัด">ระดับจังหวัด</option>
                                    <option value="เขต">ระดับเขต</option>
                                    <option value="โรงเรียน">ระดับโรงเรียน</option>
                                </select>
                                <i data-lucide="filter"
                                    class="absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-slate-500 pointer-events-none"></i>
                            </div>
                        </div>

                        <!-- Stats Summary -->
                        <div id="stats-container" class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                            <!-- Stats will be updated by JS -->
                            <div
                                class="p-5 bg-gradient-to-br from-blue-50 to-white dark:from-slate-800 dark:to-slate-900 border border-blue-100/50 dark:border-slate-700/50 rounded-2xl shadow-lg shadow-blue-100/30 dark:shadow-none hover-lift relative overflow-hidden group">
                                <div
                                    class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                                    <i data-lucide="trophy" class="w-16 h-16 text-blue-600 dark:text-blue-500"></i>
                                </div>
                                <p
                                    class="text-xs font-bold text-blue-500 dark:text-blue-400 uppercase tracking-wider mb-2">
                                    ผลงานทั้งหมด
                                </p>
                                <p class="text-3xl font-extrabold text-blue-900 dark:text-white leading-none"
                                    id="stat-total">-</p>
                            </div>
                            <div
                                class="p-5 bg-gradient-to-br from-green-50 to-white dark:from-slate-800 dark:to-slate-900 border border-green-100/50 dark:border-slate-700/50 rounded-2xl shadow-lg shadow-green-100/30 dark:shadow-none hover-lift relative overflow-hidden group">
                                <div
                                    class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                                    <i data-lucide="award" class="w-16 h-16 text-green-600 dark:text-green-500"></i>
                                </div>
                                <p class="text-xs font-bold text-green-500 uppercase tracking-wider mb-2">
                                    ระดับชาติขึ้นไป</p>
                                <p class="text-3xl font-extrabold text-green-900 dark:text-white leading-none"
                                    id="stat-national">-</p>
                            </div>

                            <!-- Teacher Stats Button -->
                            <div onclick="showTeacherStats()" role="button" aria-label="ดูผลงานครูผู้ฝึกซ้อม"
                                class="p-5 bg-gradient-to-br from-purple-50 to-white dark:from-slate-800 dark:to-slate-900 border-2 border-purple-200 dark:border-purple-800/50 border-dashed rounded-2xl shadow-lg shadow-purple-100/30 dark:shadow-none hover-lift relative overflow-hidden group cursor-pointer transition-all active:scale-95 hover:border-purple-400">
                                <div
                                    class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                                    <i data-lucide="users" class="w-16 h-16 text-purple-600 dark:text-purple-500"></i>
                                </div>
                                <p class="text-xs font-bold text-purple-500 uppercase tracking-wider mb-2">
                                    ผลงานของครูผู้ฝึกซ้อม 10 อันดับแรก</p>
                                <div class="flex items-center gap-2">
                                    <p class="text-sm font-bold text-purple-900 dark:text-white leading-none">ดูข้อมูล
                                    </p>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-purple-600"></i>
                                </div>
                            </div>

                            <!-- Dept Stats Button -->
                            <div onclick="showDeptStats()" role="button" aria-label="ดูผลงานกลุ่มสาระ"
                                class="p-5 bg-gradient-to-br from-orange-50 to-white dark:from-slate-800 dark:to-slate-900 border-2 border-orange-200 dark:border-orange-800/50 border-dashed rounded-2xl shadow-lg shadow-orange-100/30 dark:shadow-none hover-lift relative overflow-hidden group cursor-pointer transition-all active:scale-95 hover:border-orange-400">
                                <div
                                    class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                                    <i data-lucide="building-2"
                                        class="w-16 h-16 text-orange-600 dark:text-orange-500"></i>
                                </div>
                                <p class="text-xs font-bold text-orange-500 uppercase tracking-wider mb-2">
                                    ผลงานของแต่ละกลุ่มสาระ 10 อันดับแรก</p>
                                <div class="flex items-center gap-2">
                                    <p class="text-sm font-bold text-orange-900 dark:text-white leading-none">ดูข้อมูล
                                    </p>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-orange-600"></i>
                                </div>
                            </div>
                        </div>

                        <h2 class="text-lg font-bold text-gray-700 mt-4 mb-3 px-1">รายการผลงาน</h2>

                        <!-- Award List -->
                        <div id="award-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[200px]">
                            <!-- Loading State -->
                            <div
                                class="col-span-full flex flex-col items-center justify-center py-20 text-gray-400 dark:text-slate-500 animate-pulse">
                                <i data-lucide="loader-2" class="w-8 h-8 mb-2 animate-spin"></i>
                                <span class="text-sm">กำลังโหลดข้อมูล...</span>
                            </div>
                        </div>

                        <!-- Pagination Controls -->
                        <div id="pagination-controls" class="flex justify-between items-center pt-4 pb-20 hidden">
                            <button onclick="changePage(-1)" id="btn-page-prev"
                                class="px-4 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                ก่อนหน้า
                            </button>
                            <span id="page-info" class="text-xs text-gray-400">หน้า 1 / 1</span>
                            <button onclick="changePage(1)" id="btn-page-next"
                                class="px-4 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                ถัดไป
                            </button>
                        </div>
                    </div>


                    <!-- VIEW 2: FORM WIZARD -->
                    <div id="view-form" class="hidden flex-grow p-4 flex flex-col pb-24 fade-in items-center">
                        <!-- Wizard Progress Indicator -->
                        <div id="wizard-progress" class="w-full max-w-3xl px-4 md:px-0 mb-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-semibold text-blue-600" id="step-indicator">ขั้นตอนที่
                                    1/5</span>
                                <span class="text-xs text-gray-400">แบบฟอร์มบันทึก</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div id="progress-bar"
                                    class="bg-blue-600 h-1.5 rounded-full transition-all duration-300"
                                    style="width: 25%"></div>
                            </div>
                        </div>

                        <form id="wizard-form" onsubmit="event.preventDefault();"
                            class="flex-grow w-full max-w-3xl mx-auto md:bg-white md:p-8 md:rounded-2xl md:border md:border-gray-100 md:shadow-sm">

                            <!-- STEP 1: Competition Info -->
                            <div id="step-1" class="step-content">
                                <h2 class="text-xl font-bold mb-1">ข้อมูลการแข่งขัน</h2>
                                <p class="text-gray-500 mb-6 text-sm">รายละเอียดกิจกรรมและรางวัลที่ได้รับ</p>

                                <div class="grid grid-cols-1 xl:grid-cols-2 gap-5">
                                    <!-- Competition Name -->
                                    <div class="xl:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">ชื่อรายการแข่งขัน
                                            <span class="text-red-500">*</span></label>
                                        <input type="text" id="comp-name"
                                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-500 outline-none transition"
                                            placeholder="เช่น ศิลปหัตถกรรมนักเรียน">
                                        <p id="err-comp-name" class="hidden text-xs text-red-500 mt-1">
                                            กรุณากรอกชื่อรายการแข่งขัน</p>
                                    </div>

                                    <!-- Department & Work Group (Multi-Select Lists) -->
                                    <div class="xl:col-span-2 space-y-4">
                                        <h3 class="font-bold text-gray-800 border-b pb-2 mb-2">ส่งรางวัลในนาม <span
                                                class="text-sm font-normal text-gray-500">(สามารถระบุได้มากกว่า
                                                1)</span></h3>

                                        <!-- Clarification Alert -->
                                        <div class="bg-blue-50 border-l-4 border-blue-400 p-3 rounded-r-lg mb-4">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0">
                                                    <i data-lucide="info" class="h-4 w-4 text-blue-500 mt-0.5"></i>
                                                </div>
                                                <div class="ml-3">
                                                    <p class="text-sm text-blue-700">
                                                        กรุณาระบุกลุ่มสาระฯ หรือกิจกรรมที่
                                                        <strong>รับผิดชอบผลงานนี้</strong> <br class="sm:hidden">
                                                        (ไม่ใช่กลุ่มสาระฯ ที่ท่านสังกัด)
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <!-- กลุ่มสาระ Multi-Select -->
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">กลุ่มสาระฯ
                                                    <span class="text-red-500">*</span></label>
                                                <div class="flex flex-col sm:flex-row gap-2">
                                                    <select id="comp-dept-group" onchange="addDeptGroup()"
                                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-500 outline-none transition cursor-pointer text-sm font-medium truncate">
                                                        <option value="">-- เลือกกลุ่มสาระ (เลือกแล้วเพิ่มอัตโนมัติ) --
                                                        </option>
                                                        <option value="ไม่มีกลุ่มสาระ">ไม่มีกลุ่มสาระ</option>
                                                        <option>กลุ่มสาระการเรียนรู้คณิตศาสตร์</option>
                                                        <option>กลุ่มสาระการเรียนรู้วิทยาศาสตร์และเทคโนโลยี</option>
                                                        <option>กลุ่มสาระการเรียนรู้ภาษาไทย</option>
                                                        <option>กลุ่มสาระการเรียนรู้ภาษาต่างประเทศ</option>
                                                        <option>กลุ่มสาระการเรียนรู้สังคมศึกษา ศาสนาและวัฒนธรรม</option>
                                                        <option>กลุ่มสาระการเรียนรู้สุขศึกษา พลศึกษา</option>
                                                        <option>กลุ่มสาระการเรียนรู้ศิลปะ</option>
                                                        <option>กลุ่มสาระการเรียนรู้การงานอาชีพ</option>
                                                    </select>
                                                </div>
                                                <div id="dept-group-list" class="mt-2 space-y-1">
                                                    <!-- Dynamic chips render here -->
                                                </div>
                                            </div>

                                            <!-- กลุ่มงาน Multi-Select -->
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">กลุ่มงาน /
                                                    กิจกรรม
                                                    <span class="text-red-500">*</span></label>
                                                <p class="text-xs text-gray-400 mb-2">หน่วยงานย่อยนอกกลุ่มสาระฯ เช่น
                                                    งานสภานักเรียน &mdash; <strong>ถ้าไม่มี ให้เลือก
                                                        &ldquo;ไม่มีกลุ่มงาน&rdquo;</strong></p>
                                                <div class="flex flex-col sm:flex-row gap-2">
                                                    <select id="comp-dept-work" onchange="handleWorkGroupChange()"
                                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-500 outline-none transition cursor-pointer text-sm font-medium truncate">
                                                        <option value="">-- เลือกกลุ่มงาน (เลือกแล้วเพิ่มอัตโนมัติ) --
                                                        </option>
                                                        <option value="ไม่มีกลุ่มงาน">ไม่มีกลุ่มงาน</option>
                                                        <option>งานแนะแนว</option>
                                                        <option>งานเทคโนโลยี</option>
                                                        <option>กิจกรรมพัฒนาผู้เรียน (ลูกเสือ)</option>
                                                        <option>งานห้องเรียนพิเศษ SMTE</option>
                                                        <option>งานสภานักเรียน</option>
                                                        <option>งานห้องสมุด</option>
                                                        <option>งานห้องเรียนสีเขียว</option>
                                                        <option>งาน to be number one</option>
                                                        <option value="other">อื่นๆ (ระบุ)</option>
                                                    </select>
                                                </div>
                                                <div id="work-other-container" class="hidden mt-2 flex gap-2 fade-in">
                                                    <input type="text" id="comp-work-other"
                                                        class="flex-1 px-4 py-3 rounded-xl border border-gray-200 bg-white focus:ring-2 focus:ring-blue-100 outline-none text-sm"
                                                        placeholder="พิมพ์ชื่อกลุ่มงาน...">
                                                    <button type="button" onclick="addWorkGroup()"
                                                        class="px-4 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl text-sm font-bold transition shrink-0 flex items-center gap-1">
                                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                                        เพิ่ม
                                                    </button>
                                                </div>
                                                <div id="dept-work-list" class="mt-2 space-y-1">
                                                    <!-- Dynamic chips render here -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Organization (External) -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">รับรางวัลจากหน่วยงาน
                                            <span class="text-red-500">*</span></label>
                                        <input type="text" id="comp-org" required
                                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-500 outline-none transition"
                                            placeholder="เช่น สพฐ., มหาวิทยาลัย...">
                                        <p id="err-comp-org" class="hidden text-xs text-red-500 mt-1">กรุณาระบุหน่วยงาน
                                        </p>
                                    </div>

                                    <!-- Date -->
                                    <div class="xl:col-span-1">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">วันที่ได้รับรางวัล
                                            <span class="text-xs text-gray-500 font-normal">(ปี ค.ศ.)</span>
                                            <span class="text-red-500">*</span></label>
                                        <div class="relative">
                                            <input type="date" id="comp-date" required
                                                class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none text-gray-600 cursor-pointer">
                                        </div>
                                        <p id="err-comp-date" class="hidden text-xs text-red-500 mt-1">กรุณาเลือกวันที่
                                        </p>
                                    </div>

                                    <!-- Rank -->
                                    <div class="xl:col-span-1">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">รางวัลที่ได้รับ
                                            <span class="text-red-500">*</span></label>
                                        <select id="comp-rank" onchange="toggleOtherRank()"
                                            class="w-full px-4 py-3 rounded-xl border border-blue-200 bg-blue-50 focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-500 outline-none text-blue-900 font-semibold cursor-pointer">
                                            <option value="">-- เลือกรางวัล --</option>
                                            <option value="ชนะเลิศ">ชนะเลิศ</option>
                                            <option value="รองชนะเลิศอันดับที่ 1">รองชนะเลิศอันดับที่ 1</option>
                                            <option value="รองชนะเลิศอันดับที่ 2">รองชนะเลิศอันดับที่ 2</option>
                                            <option value="รองชนะเลิศอันดับที่ 3">รองชนะเลิศอันดับที่ 3</option>
                                            <option value="เหรียญทอง">เหรียญทอง</option>
                                            <option value="เหรียญเงิน">เหรียญเงิน</option>
                                            <option value="เหรียญทองแดง">เหรียญทองแดง</option>
                                            <option value="ชมเชย">ชมเชย</option>
                                            <option value="เข้าร่วม">เข้าร่วม</option>
                                            <option value="other">อื่นๆ (โปรดระบุ)</option>
                                        </select>
                                        <input type="text" id="comp-rank-other"
                                            class="mt-2 w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:ring-2 focus:ring-blue-100 outline-none hidden fade-in"
                                            placeholder="ระบุชื่อรางวัล...">
                                        <p id="err-comp-rank" class="hidden text-xs text-red-500 mt-1">กรุณาเลือกรางวัล
                                        </p>
                                    </div>

                                    <!-- Level (Chips) -->
                                    <div class="xl:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ระดับการแข่งขัน
                                            <span class="text-red-500">*</span></label>
                                        <div id="level-container" class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                            <label class="cursor-pointer">
                                                <input type="radio" name="level" value="school"
                                                    class="hidden radio-card">
                                                <div
                                                    class="border border-gray-200 rounded-lg p-3 text-center text-sm font-medium text-gray-600 hover:bg-gray-50 transition">
                                                    ระดับโรงเรียน
                                                </div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" name="level" value="district"
                                                    class="hidden radio-card">
                                                <div
                                                    class="border border-gray-200 rounded-lg p-3 text-center text-sm font-medium text-gray-600 hover:bg-gray-50 transition">
                                                    ระดับอำเภอ
                                                </div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" name="level" value="area" class="hidden radio-card">
                                                <div
                                                    class="border border-gray-200 rounded-lg p-3 text-center text-sm font-medium text-gray-600 hover:bg-gray-50 transition">
                                                    ระดับเขตพื้นที่ฯ
                                                </div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" name="level" value="province"
                                                    class="hidden radio-card">
                                                <div
                                                    class="border border-gray-200 rounded-lg p-3 text-center text-sm font-medium text-gray-600 hover:bg-gray-50 transition">
                                                    ระดับจังหวัด</div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" name="level" value="region"
                                                    class="hidden radio-card">
                                                <div
                                                    class="border border-gray-200 rounded-lg p-3 text-center text-sm font-medium text-gray-600 hover:bg-gray-50 transition">
                                                    ระดับภาค</div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" name="level" value="nation"
                                                    class="hidden radio-card">
                                                <div
                                                    class="border border-gray-200 rounded-lg p-3 text-center text-sm font-medium text-gray-600 hover:bg-gray-50 transition">
                                                    ระดับชาติ</div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" name="level" value="inter"
                                                    class="hidden radio-card">
                                                <div
                                                    class="border border-gray-200 rounded-lg p-3 text-center text-sm font-medium text-gray-600 hover:bg-gray-50 transition">
                                                    ระดับนานาชาติ</div>
                                            </label>
                                        </div>
                                    </div>


                                </div>
                            </div>

                            <!-- STEP 2: Evidence / File Upload -->
                            <div id="step-2" class="step-content hidden">
                                <h2 class="text-xl font-bold mb-1">หลักฐานการได้รับรางวัล</h2>
                                <p class="text-gray-500 mb-6 text-sm">แนบไฟล์เกียรติบัตร หรือรูปภาพกิจกรรม อย่างน้อย 1
                                    รายการ</p>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- Certificate Upload -->
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1 font-medium">1. รูปภาพเกียรติบัตร / PDF</p>
                                        <div class="file-upload-zone rounded-xl p-4 text-center cursor-pointer border-2 border-dashed border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition"
                                            onclick="document.getElementById('evidence-cert').click()">
                                            <input type="file" id="evidence-cert" class="hidden" accept="image/*,.pdf"
                                                onchange="handleFileSelect(event, 'cert')">
                                            <div id="cert-placeholder" class="py-4">
                                                <i data-lucide="file-badge"
                                                    class="w-8 h-8 mx-auto text-gray-400 mb-1"></i>
                                                <p class="text-xs text-blue-600 font-medium">แนบไฟล์เกียรติบัตร</p>
                                            </div>
                                            <div id="cert-preview"
                                                class="hidden flex items-center justify-center gap-2 py-2">
                                                <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
                                                <span class="text-xs font-semibold text-gray-700 truncate max-w-[120px]"
                                                    id="cert-name">filename.pdf</span>
                                                <button type="button" onclick="clearSpecificFile(event, 'cert')"
                                                    class="text-red-400 hover:text-red-600"><i data-lucide="x"
                                                        class="w-4 h-4"></i></button>
                                            </div>
                                        </div>
                                        <!-- Example Image 1 -->
                                        <div class="mt-2 text-center">
                                            <p class="text-xs text-gray-400 mb-1">ตัวอย่างเกียรติบัตร:</p>
                                            <img src="assets/example_certificates.jpg" alt="ตัวอย่างเกียรติบัตร"
                                                class="w-full h-auto rounded-lg border border-gray-200 object-cover bg-gray-50 min-h-[150px]">
                                        </div>
                                    </div>

                                    <!-- Activity Photo Upload -->
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1 font-medium">2. รูปภาพขณะทำกิจกรรม /
                                            รับรางวัล</p>
                                        <div class="file-upload-zone rounded-xl p-4 text-center cursor-pointer border-2 border-dashed border-gray-200 hover:border-green-400 hover:bg-green-50 transition"
                                            onclick="document.getElementById('evidence-photo').click()">
                                            <input type="file" id="evidence-photo" class="hidden" accept="image/*"
                                                onchange="handleFileSelect(event, 'photo')">
                                            <div id="photo-placeholder" class="py-4">
                                                <i data-lucide="image" class="w-8 h-8 mx-auto text-gray-400 mb-1"></i>
                                                <p class="text-xs text-green-600 font-medium">แนบรูปภาพกิจกรรม</p>
                                            </div>
                                            <div id="photo-preview"
                                                class="hidden flex items-center justify-center gap-2 py-2">
                                                <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
                                                <span class="text-xs font-semibold text-gray-700 truncate max-w-[120px]"
                                                    id="photo-name">image.jpg</span>
                                                <button type="button" onclick="clearSpecificFile(event, 'photo')"
                                                    class="text-red-400 hover:text-red-600"><i data-lucide="x"
                                                        class="w-4 h-4"></i></button>
                                            </div>
                                        </div>
                                        <!-- Example Image 2 -->
                                        <div class="mt-2 text-center">
                                            <p class="text-xs text-gray-400 mb-1">ตัวอย่างรูปกิจกรรม:</p>
                                            <img src="assets/example_activity.jpg" alt="ตัวอย่างรูปกิจกรรม"
                                                class="w-full h-auto rounded-lg border border-gray-200 object-cover bg-gray-50 min-h-[150px]">
                                        </div>
                                    </div>
                                </div>
                                <p id="file-error" class="hidden text-xs text-red-500 text-center mt-4">
                                    กรุณาแนบไฟล์อย่างน้อย 1 รายการ</p>
                            </div>

                            <!-- STEP 3: Students -->
                            <div id="step-3" class="step-content hidden">
                                <h2 class="text-xl font-bold mb-1">รายชื่อนักเรียน</h2>
                                <p class="text-gray-500 mb-6 text-sm">เพิ่มนักเรียนที่เข้าร่วมการแข่งขัน</p>

                                <div id="student-list" class="space-y-3 mb-6 min-h-[100px]">
                                    <div onclick="openStudentModal(-1)"
                                        class="text-center py-8 bg-gray-50 hover:bg-blue-50 cursor-pointer rounded-xl border-2 border-dashed border-gray-200 hover:border-blue-300 transition group">
                                        <div
                                            class="w-12 h-12 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-sm group-hover:scale-110 transition">
                                            <i data-lucide="user-plus"
                                                class="w-6 h-6 text-gray-300 group-hover:text-blue-500 transition"></i>
                                        </div>
                                        <p
                                            class="text-gray-400 text-sm group-hover:text-blue-600 font-medium transition">
                                            ยังไม่มีรายชื่อนักเรียน</p>
                                        <p class="text-xs text-gray-300 group-hover:text-blue-400 mt-1 transition">
                                            คลิกเพื่อเพิ่มรายชื่อ</p>
                                    </div>
                                </div>

                                <button onclick="openStudentModal(-1)"
                                    class="w-full py-3 rounded-xl border-2 border-dashed border-blue-400 text-blue-600 font-semibold hover:bg-blue-50 transition flex items-center justify-center gap-2">
                                    <i data-lucide="user-plus" class="w-5 h-5"></i>
                                    เพิ่มนักเรียน
                                </button>
                            </div>

                            <!-- STEP 4: Teachers -->
                            <div id="step-4" class="step-content hidden">
                                <h2 class="text-xl font-bold mb-1">ครูผู้ฝึกซ้อม</h2>
                                <p class="text-gray-500 mb-6 text-sm">เพิ่มรายชื่อครูที่ปรึกษา</p>

                                <div id="teacher-list" class="space-y-3 mb-6 min-h-[100px]">
                                    <div onclick="openTeacherModal(-1)"
                                        class="text-center py-8 bg-gray-50 hover:bg-green-50 cursor-pointer rounded-xl border-2 border-dashed border-gray-200 hover:border-green-300 transition group">
                                        <div
                                            class="w-12 h-12 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-sm group-hover:scale-110 transition">
                                            <i data-lucide="user-plus"
                                                class="w-6 h-6 text-gray-300 group-hover:text-green-500 transition"></i>
                                        </div>
                                        <p
                                            class="text-gray-400 text-sm group-hover:text-green-600 font-medium transition">
                                            ยังไม่มีรายชื่อครู</p>
                                        <p class="text-xs text-gray-300 group-hover:text-green-400 mt-1 transition">
                                            คลิกเพื่อเพิ่มรายชื่อ</p>
                                    </div>
                                </div>

                                <button onclick="openTeacherModal(-1)"
                                    class="w-full py-3 rounded-xl border-2 border-dashed border-green-400 text-green-600 font-semibold hover:bg-green-50 transition flex items-center justify-center gap-2">
                                    <i data-lucide="user-plus" class="w-5 h-5"></i>
                                    เพิ่มรายชื่อครู
                                </button>
                            </div>

                            <!-- STEP 5: Summary -->
                            <div id="step-5" class="step-content hidden">
                                <h2 class="text-xl font-bold mb-1">ตรวจสอบข้อมูล</h2>
                                <p class="text-gray-500 mb-6 text-sm">กรุณาตรวจสอบความถูกต้องก่อนบันทึก</p>

                                <!-- Warning Alert -->
                                <div class="bg-orange-50 border-l-4 border-orange-400 p-4 rounded-r-lg mb-6">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <i data-lucide="alert-triangle" class="h-5 w-5 text-orange-400"></i>
                                        </div>
                                        <div class="ml-3">
                                            <h3 class="text-sm font-bold text-orange-800">กรุณาตรวจสอบความถูกต้อง</h3>
                                            <div class="mt-2 text-sm text-orange-700 space-y-1">
                                                <p>1. ตรวจสอบว่า <strong>"ส่งรางวัลในนาม"</strong> ถูกต้อง
                                                    (ระบุกลุ่มสาระฯ ที่รับผิดชอบผลงาน)</p>
                                                <p>2. เมื่อบันทึกแล้ว <strong>จะไม่สามารถแก้ไขข้อมูลได้</strong></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-6">
                                    <div class="bg-blue-50/50 p-5 rounded-xl border border-blue-100">
                                        <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                            <i data-lucide="trophy" class="w-5 h-5 text-blue-600"></i>
                                            ข้อมูลรางวัล
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1">รายการแข่งขัน</p>
                                                <p class="font-semibold text-gray-800" id="summary-comp-name">-</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1">ระดับ</p>
                                                <p class="font-semibold text-gray-800" id="summary-comp-level">-</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1">รางวัลที่ได้รับ</p>
                                                <p class="font-semibold text-blue-600" id="summary-comp-rank">-</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400 text-xs mb-1">วันที่</p>
                                                <p class="font-semibold text-gray-800" id="summary-comp-date">-</p>
                                            </div>
                                            <div class="md:col-span-2">
                                                <p class="text-gray-400 text-xs mb-1">ส่งรางวัลในนาม</p>
                                                <p class="text-gray-400 text-xs mb-1">กลุ่มสาระฯ/งาน</p>
                                                <p class="font-semibold text-gray-800" id="summary-comp-dept">-</p>
                                            </div>
                                            <div class="md:col-span-2">
                                                <p class="text-gray-400 text-xs mb-1">หน่วยงานจัดแข่ง</p>
                                                <p class="font-semibold text-gray-800" id="summary-comp-org">-</p>
                                            </div>
                                            <div class="md:col-span-2 hidden" id="summary-evidence-container">
                                                <p class="text-gray-400 text-xs mb-1">ไฟล์หลักฐาน</p>
                                                <div
                                                    class="flex items-center gap-2 text-blue-600 bg-white p-2 rounded-lg border border-blue-100 inline-flex">
                                                    <i data-lucide="file-check" class="w-4 h-4"></i>
                                                    <span class="font-medium truncate max-w-xs"
                                                        id="summary-evidence-text"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="bg-gray-50/50 p-5 rounded-xl border border-gray-100">
                                            <div class="flex items-center justify-between mb-3">
                                                <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                                    <i data-lucide="users" class="w-4 h-4 text-gray-600"></i>
                                                    นักเรียน
                                                </h3>
                                                <span
                                                    class="bg-gray-200 text-gray-600 text-xs font-bold px-2 py-0.5 rounded-full"
                                                    id="summary-student-count">0</span>
                                            </div>
                                            <div class="space-y-2 max-h-40 overflow-y-auto pr-1 custom-scrollbar text-sm"
                                                id="summary-student-list">
                                                <!-- List -->
                                            </div>
                                        </div>

                                        <div class="bg-gray-50/50 p-5 rounded-xl border border-gray-100">
                                            <div class="flex items-center justify-between mb-3">
                                                <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                                    <i data-lucide="user-check" class="w-4 h-4 text-gray-600"></i>
                                                    ครูผู้ฝึกซ้อม
                                                </h3>
                                                <span
                                                    class="bg-gray-200 text-gray-600 text-xs font-bold px-2 py-0.5 rounded-full"
                                                    id="summary-teacher-count">0</span>
                                            </div>
                                            <div class="space-y-2 max-h-40 overflow-y-auto pr-1 custom-scrollbar text-sm"
                                                id="summary-teacher-list">
                                                <!-- List -->
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- Buttons -->
                            <div class="flex justify-between mt-8 pt-6 border-t border-gray-100">
                                <button onclick="changeStep(-1)" id="btn-prev"
                                    class="hidden px-6 py-2.5 rounded-xl text-gray-600 hover:bg-gray-100 font-medium transition">
                                    ย้อนกลับ
                                </button>
                                <div class="ml-auto">
                                    <button onclick="changeStep(1)" id="btn-next"
                                        class="px-8 py-2.5 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-200">
                                        ถัดไป
                                    </button>
                                    <button onclick="saveAward()" id="btn-submit"
                                        class="hidden px-8 py-2.5 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition shadow-lg shadow-green-200">
                                        ยืนยันการบันทึก
                                    </button>
                                </div>
                            </div>

                        </form>
                    </div>
                    <!-- Footer -->
                    <footer
                        class="py-6 w-full text-center text-sm text-gray-400 flex items-center justify-center gap-2 mt-auto print:hidden">
                        <span>Made with</span>
                        <i data-lucide="heart" class="w-4 h-4 text-red-400 fill-current"></i>
                        <span>by namo</span>
                        <a href="https://github.com/namo5758" target="_blank" rel="noopener noreferrer"
                            class="ml-2 hover:text-gray-600 transition-colors">
                            <i data-lucide="github" class="w-4 h-4"></i>
                        </a>
                    </footer>
                </div>
            </div>

            <!-- VIEW 3: SUBJECT SUMMARY (New Feature) -->
            <div id="view-subject-summary"
                class="hidden flex flex-col h-full bg-white dark:bg-slate-900 fixed inset-0 z-[45] lg:absolute lg:inset-0 lg:top-16 lg:z-30 lg:bg-white/95 dark:lg:bg-slate-900/95 lg:backdrop-blur-sm overflow-hidden lg:overflow-y-auto">
                <!-- Header (Mobile Only) -->
                <div
                    class="lg:hidden p-4 bg-white dark:bg-slate-900 border-b border-gray-100 dark:border-slate-800 flex items-center gap-3">
                    <button onclick="switchView('dashboard')"
                        class="p-2 -ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                    <h2 class="font-bold text-lg text-gray-800 dark:text-white">สรุปตามกลุ่มสาระฯ</h2>
                </div>

                <div
                    class="flex flex-col h-full lg:h-auto overflow-hidden lg:overflow-visible lg:max-w-[1200px] lg:mx-auto lg:w-full lg:px-8 lg:pt-6">
                    <!-- Filters Area -->
                    <div
                        class="p-4 bg-white dark:bg-slate-900 border-b border-gray-100 dark:border-slate-800 lg:bg-transparent lg:border-0 lg:p-0 lg:mb-6">
                        <input type="text" id="subject-search-input" oninput="handleSubjectSearch()"
                            placeholder="ค้นหาชื่อรายการ..."
                            class="w-full px-4 py-3 bg-gray-50 dark:bg-slate-800 border-0 rounded-xl text-sm mb-3 lg:bg-white lg:border lg:border-gray-200 focus:ring-2 focus:ring-blue-100 outline-none">

                        <!-- Subject Dropdown (Mobile) -->
                        <div class="lg:hidden">
                            <div class="relative">
                                <select id="subject-dropdown-mobile" onchange="setSubjectFilter(this.value)"
                                    class="w-full pl-4 pr-10 py-3 bg-gray-50 dark:bg-slate-800 border-0 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-100 appearance-none text-gray-700 font-medium">
                                    <option value="all">ทุกกลุ่มสาระฯ</option>
                                </select>
                                <div
                                    class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Area -->
                    <div class="flex-1 overflow-y-auto p-4 lg:p-0 lg:overflow-visible lg:h-auto lg:flex-none">
                        <!-- Level Filter Buttons -->
                        <div class="flex flex-wrap gap-2 mb-4">
                            <button id="btn-filter-lvl-all" onclick="setLevelFilter('all')"
                                class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-blue-600 text-white shadow-md transition hover:opacity-90">
                                <i data-lucide="layers" class="w-3.5 h-3.5"></i> ทั้งหมด
                            </button>
                            <button id="btn-filter-lvl-international" onclick="setLevelFilter('international')"
                                class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 dark:bg-slate-800 dark:text-gray-300 transition hover:opacity-90">
                                <i data-lucide="globe" class="w-3.5 h-3.5"></i> นานาชาติ
                            </button>
                            <button id="btn-filter-lvl-nation" onclick="setLevelFilter('nation')"
                                class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 dark:bg-slate-800 dark:text-gray-300 transition hover:opacity-90">
                                <i data-lucide="flag" class="w-3.5 h-3.5"></i> ระดับชาติ
                            </button>
                            <button id="btn-filter-lvl-region" onclick="setLevelFilter('region')"
                                class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 dark:bg-slate-800 dark:text-gray-300 transition hover:opacity-90">
                                <i data-lucide="map-pin" class="w-3.5 h-3.5"></i> ระดับภาค
                            </button>
                            <button id="btn-filter-lvl-province" onclick="setLevelFilter('province')"
                                class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 dark:bg-slate-800 dark:text-gray-300 transition hover:opacity-90">
                                <i data-lucide="building-2" class="w-3.5 h-3.5"></i> จังหวัด
                            </button>
                            <button id="btn-filter-lvl-area" onclick="setLevelFilter('area')"
                                class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 dark:bg-slate-800 dark:text-gray-300 transition hover:opacity-90">
                                <i data-lucide="map" class="w-3.5 h-3.5"></i> เขตพื้นที่
                            </button>
                            <button id="btn-filter-lvl-school" onclick="setLevelFilter('school')"
                                class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 dark:bg-slate-800 dark:text-gray-300 transition hover:opacity-90">
                                <i data-lucide="school" class="w-3.5 h-3.5"></i> โรงเรียน
                            </button>
                        </div>

                        <!-- Stats Cards -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                            <div
                                class="bg-blue-50/50 dark:bg-blue-900/20 p-3 rounded-xl border border-blue-100 dark:border-blue-800/50 text-center">
                                <p class="text-xs text-blue-500 dark:text-blue-400 font-bold uppercase">ทั้งหมด</p>
                                <p class="text-2xl font-extrabold text-blue-700 dark:text-blue-300"
                                    id="stat-summary-total">0</p>
                            </div>
                            <div
                                class="bg-rose-50/50 dark:bg-rose-900/20 p-3 rounded-xl border border-rose-100 dark:border-rose-800/50 text-center">
                                <p class="text-xs text-rose-500 dark:text-rose-400 font-bold uppercase">นานาชาติ</p>
                                <p class="text-2xl font-extrabold text-rose-700 dark:text-rose-300" id="stat-inter">0
                                </p>
                            </div>
                            <div
                                class="bg-purple-50/50 dark:bg-purple-900/20 p-3 rounded-xl border border-purple-100 dark:border-purple-800/50 text-center">
                                <p class="text-xs text-purple-500 dark:text-purple-400 font-bold uppercase">ระดับชาติ
                                </p>
                                <p class="text-2xl font-extrabold text-purple-700 dark:text-purple-300"
                                    id="stat-nation">0</p>
                            </div>
                            <div
                                class="bg-indigo-50/50 dark:bg-indigo-900/20 p-3 rounded-xl border border-indigo-100 dark:border-indigo-800/50 text-center">
                                <p class="text-xs text-indigo-500 dark:text-indigo-400 font-bold uppercase">ระดับภาค</p>
                                <p class="text-2xl font-extrabold text-indigo-700 dark:text-indigo-300"
                                    id="stat-region">0</p>
                            </div>
                        </div>

                        <!-- List -->
                        <h3 class="font-bold text-gray-700 dark:text-gray-200 mb-3 px-1">รายชื่อผลงาน</h3>
                        <div id="subject-result-list" class="space-y-3 pb-24">
                            <!-- Loading State -->
                            <div
                                class="flex flex-col items-center justify-center py-20 text-gray-400 dark:text-slate-500 animate-pulse">
                                <i data-lucide="loader-2" class="w-8 h-8 mb-2 animate-spin"></i>
                                <span class="text-sm">กำลังโหลดข้อมูล...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 4: PENDING REWARDS -->
            <div id="view-pending-rewards"
                class="hidden flex flex-col h-full fixed inset-0 z-[45] bg-white dark:bg-slate-900 lg:absolute lg:inset-0 lg:top-16 lg:z-30 lg:bg-white dark:lg:bg-slate-900 fade-in overflow-hidden">
                <div class="flex flex-col h-full lg:max-w-[1200px] lg:mx-auto lg:w-full lg:px-8 lg:pt-6 relative">
                    <!-- Header -->
                    <div
                        class="p-4 border-b border-gray-100 bg-white dark:bg-slate-900 lg:bg-transparent lg:border-0 lg:p-0 lg:mb-4 flex items-center justify-between shrink-0">
                        <div class="flex items-center gap-3 lg:hidden">
                            <button onclick="switchView('dashboard')"
                                class="p-2 -ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 print:hidden">
                                <i data-lucide="arrow-left" class="w-6 h-6"></i>
                            </button>
                            <h2 class="font-bold text-lg text-gray-800 dark:text-white">รางวัลรอรับ</h2>
                        </div>
                        <div class="hidden lg:block">
                            <h2 class="font-bold text-lg text-gray-800 dark:text-white">รายการรางวัลที่รอรับ</h2>
                            <p class="text-xs text-gray-400 dark:text-gray-500">
                                รายการที่ได้รับรางวัลแต่ยังไม่ได้ระบุว่ารับแล้ว</p>
                        </div>

                        <div class="flex items-center gap-2">
                            <button onclick="toggleSelectionMode()" id="btn-toggle-select"
                                class="flex items-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-600 rounded-lg text-sm font-bold transition print:hidden">
                                <i data-lucide="check-square" class="w-4 h-4"></i>
                                <span class="hidden sm:inline">เลือกรายการ</span>
                            </button>
                            <button onclick="savePendingRewardsPDF()"
                                class="flex items-center gap-2 px-4 py-2 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg text-sm font-bold transition print:hidden">
                                <i data-lucide="file-down" class="w-4 h-4"></i>
                                <span class="hidden sm:inline">Save PDF</span>
                            </button>
                            <button onclick="savePendingRewardsExcel()"
                                class="flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-600 rounded-lg text-sm font-bold transition print:hidden">
                                <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                                <span class="hidden sm:inline">Excel</span>
                            </button>
                            <button onclick="printPendingRewards()"
                                class="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm font-bold transition print:hidden">
                                <i data-lucide="printer" class="w-4 h-4"></i>
                                <span class="hidden sm:inline">พิมพ์รายงาน</span>
                            </button>
                        </div>
                    </div>

                    <!-- Tabs: รอรับ / รับแล้ว -->
                    <div class="flex gap-1 px-4 lg:px-0 pt-2 pb-0 shrink-0 print:hidden">
                        <button id="tab-pending" onclick="switchRewardTab('pending')"
                            class="px-4 py-2 text-sm font-bold rounded-t-lg border border-b-0 transition bg-white text-blue-600 border-gray-200 dark:bg-slate-800 dark:text-blue-400 dark:border-slate-700">
                            <i data-lucide="clock" class="w-4 h-4 inline -mt-0.5 mr-1"></i>รอรับ
                            <span id="tab-pending-count"
                                class="ml-1 text-xs bg-blue-100 text-blue-600 dark:bg-blue-900/40 dark:text-blue-300 px-1.5 py-0.5 rounded-full">0</span>
                        </button>
                        <button id="tab-received" onclick="switchRewardTab('received')"
                            class="px-4 py-2 text-sm font-bold rounded-t-lg border border-b-0 transition bg-gray-50 text-gray-400 border-gray-200 dark:bg-slate-900 dark:text-gray-500 dark:border-slate-700">
                            <i data-lucide="check-circle" class="w-4 h-4 inline -mt-0.5 mr-1"></i>รับแล้ว
                            <span id="tab-received-count"
                                class="ml-1 text-xs bg-gray-100 text-gray-500 dark:bg-slate-700 dark:text-gray-400 px-1.5 py-0.5 rounded-full">0</span>
                        </button>
                    </div>

                    <!-- ===== TAB CONTENT: PENDING (รอรับ) ===== -->
                    <div id="reward-tab-pending" class="flex-1 flex flex-col overflow-hidden">
                        <!-- Search -->
                        <div
                            class="p-4 bg-gray-50 border-b border-gray-100 dark:bg-slate-800 dark:border-slate-700 lg:rounded-b-xl lg:rounded-tr-xl lg:border lg:mb-4 shrink-0 print:hidden">
                            <div class="relative">
                                <i data-lucide="search"
                                    class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                <input type="text" id="pending-search-input" oninput="renderPendingRewards()"
                                    placeholder="ค้นหารายการ, ชื่อนักเรียน..."
                                    class="w-full pl-9 pr-4 py-2.5 bg-white border border-gray-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-100 transition">
                            </div>
                        </div>

                        <!-- Table (Desktop) -->
                        <div
                            class="flex-1 overflow-auto bg-white dark:bg-slate-900 lg:rounded-xl lg:border lg:border-gray-200 dark:lg:border-slate-700 lg:shadow-sm">
                            <table id="pending-rewards-table" class="w-full text-left border-collapse">
                                <thead class="bg-gray-50 text-gray-500 text-xs uppercase sticky top-0 z-10 shadow-sm">
                                    <tr>
                                        <th
                                            class="px-4 py-3 font-semibold w-12 hidden select-col transition-all duration-300">
                                            <div class="w-4 h-4 rounded border border-gray-300"></div>
                                        </th>
                                        <th class="px-4 py-3 font-semibold w-24">รางวัล</th>
                                        <th class="px-4 py-3 font-semibold">รายการแข่งขัน</th>
                                        <th class="px-4 py-3 font-semibold w-24">ระดับ</th>
                                        <th class="px-4 py-3 font-semibold w-32">หน่วยงาน</th>
                                        <th class="px-4 py-3 font-semibold">นักเรียน</th>
                                        <th class="px-4 py-3 font-semibold">ครูที่ปรึกษา</th>
                                        <th class="px-4 py-3 font-semibold w-24 text-center">หลักฐาน</th>
                                    </tr>
                                </thead>
                                <!-- Tbody will be generated by JS -->
                            </table>
                            <div id="no-pending-data"
                                class="flex flex-col items-center justify-center py-20 text-gray-400 dark:text-slate-500">
                                <i data-lucide="loader-2" class="w-8 h-8 mb-2 animate-spin"></i>
                                <span class="text-sm">กำลังโหลดข้อมูล...</span>
                            </div>
                        </div>

                        <!-- Mobile Card Layout -->
                        <div id="pending-rewards-cards" class="md:hidden flex-1 overflow-y-auto p-4 space-y-3">
                            <!-- Cards rendered by JS -->
                        </div>
                    </div>

                    <!-- ===== TAB CONTENT: RECEIVED (รับแล้ว) ===== -->
                    <div id="reward-tab-received" class="hidden flex-1 flex flex-col overflow-hidden">
                        <!-- Search + Date Filter -->
                        <div
                            class="p-4 bg-gray-50 border-b border-gray-100 dark:bg-slate-800 dark:border-slate-700 lg:rounded-b-xl lg:rounded-tr-xl lg:border lg:mb-4 shrink-0 print:hidden">
                            <div class="flex flex-col sm:flex-row gap-2">
                                <div class="relative flex-1">
                                    <i data-lucide="search"
                                        class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" id="received-search-input" oninput="renderReceivedRewards()"
                                        placeholder="ค้นหารายการที่รับแล้ว..."
                                        class="w-full pl-9 pr-4 py-2.5 bg-white border border-gray-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-100 transition">
                                </div>
                                <div class="flex items-center gap-2 shrink-0 flex-wrap">
                                    <div class="relative">
                                        <button onclick="toggleDateRangePicker()" id="date-range-toggle"
                                            class="flex items-center gap-2 py-2.5 px-3 bg-white border border-gray-200 rounded-lg text-sm outline-none hover:border-blue-300 focus:ring-2 focus:ring-blue-100 transition min-w-[180px] cursor-pointer">
                                            <i data-lucide="calendar" class="w-4 h-4 text-gray-400"></i>
                                            <span id="date-range-label"
                                                class="text-gray-600 font-medium truncate">ทุกช่วงเวลา</span>
                                            <i data-lucide="chevron-down" class="w-3.5 h-3.5 text-gray-400 ml-auto"></i>
                                        </button>
                                        <!-- Date Range Dropdown -->
                                        <div id="date-range-picker"
                                            class="hidden absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-xl shadow-xl z-30 w-[320px] p-4 space-y-3">
                                            <div class="flex flex-wrap gap-1.5">
                                                <button onclick="setDatePreset('all')"
                                                    class="date-preset-btn px-2.5 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-600 hover:bg-blue-200 transition">ทั้งหมด</button>
                                                <button onclick="setDatePreset('this-month')"
                                                    class="date-preset-btn px-2.5 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 transition">เดือนนี้</button>
                                                <button onclick="setDatePreset('last-month')"
                                                    class="date-preset-btn px-2.5 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 transition">เดือนที่แล้ว</button>
                                                <button onclick="setDatePreset('3-months')"
                                                    class="date-preset-btn px-2.5 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 transition">3
                                                    เดือน</button>
                                                <button onclick="setDatePreset('6-months')"
                                                    class="date-preset-btn px-2.5 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 transition">6
                                                    เดือน</button>
                                                <button onclick="setDatePreset('this-year')"
                                                    class="date-preset-btn px-2.5 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-600 hover:bg-gray-200 transition">ปีนี้</button>
                                            </div>
                                            <div class="border-t border-gray-100 pt-3">
                                                <p class="text-xs font-bold text-gray-500 mb-2">กำหนดช่วงเวลาเอง</p>
                                                <div class="grid grid-cols-2 gap-2">
                                                    <div>
                                                        <label
                                                            class="text-[10px] text-gray-400 font-medium">ตั้งแต่</label>
                                                        <input type="date" id="date-range-from"
                                                            onchange="applyCustomDateRange()"
                                                            class="w-full px-2.5 py-2 bg-gray-50 border border-gray-200 rounded-lg text-xs outline-none focus:ring-2 focus:ring-blue-100 transition">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] text-gray-400 font-medium">ถึง</label>
                                                        <input type="date" id="date-range-to"
                                                            onchange="applyCustomDateRange()"
                                                            class="w-full px-2.5 py-2 bg-gray-50 border border-gray-200 rounded-lg text-xs outline-none focus:ring-2 focus:ring-blue-100 transition">
                                                    </div>
                                                </div>
                                            </div>
                                            <button onclick="clearDateRange()"
                                                class="w-full py-1.5 text-xs text-red-500 hover:text-red-600 font-medium hover:bg-red-50 rounded-lg transition">ล้างตัวกรอง</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Table (Desktop) -->
                        <div
                            class="flex-1 overflow-auto bg-white dark:bg-slate-900 lg:rounded-xl lg:border lg:border-gray-200 dark:lg:border-slate-700 lg:shadow-sm">
                            <table id="received-rewards-table" class="w-full text-left border-collapse">
                                <thead
                                    class="bg-green-50 dark:bg-green-900/20 text-gray-500 text-xs uppercase sticky top-0 z-10 shadow-sm">
                                    <tr>
                                        <th class="px-4 py-3 font-semibold w-12">
                                            <input type="checkbox" id="received-select-all"
                                                onchange="toggleReceivedSelectAll(this)"
                                                class="w-4 h-4 rounded border-gray-300 text-green-600 focus:ring-green-500">
                                        </th>
                                        <th class="px-4 py-3 font-semibold w-24">รางวัล</th>
                                        <th class="px-4 py-3 font-semibold">รายการแข่งขัน</th>
                                        <th class="px-4 py-3 font-semibold w-24">ระดับ</th>
                                        <th class="px-4 py-3 font-semibold w-32">หน่วยงาน</th>
                                        <th class="px-4 py-3 font-semibold">นักเรียน</th>
                                        <th class="px-4 py-3 font-semibold">ครูที่ปรึกษา</th>
                                        <th class="px-4 py-3 font-semibold w-28 text-center">คืนรายการ</th>
                                    </tr>
                                </thead>
                                <tbody id="received-rewards-tbody">
                                    <!-- Rows generated by JS -->
                                </tbody>
                            </table>
                            <div id="no-received-data"
                                class="hidden flex flex-col items-center justify-center py-20 text-gray-400">
                                <i data-lucide="inbox" class="w-12 h-12 mb-3 text-gray-200 dark:text-slate-600"></i>
                                <p>ยังไม่มีรายการที่รับรางวัลแล้ว</p>
                            </div>
                        </div>

                        <!-- Mobile Card Layout -->
                        <div id="received-rewards-cards" class="md:hidden flex-1 overflow-y-auto p-4 space-y-3">
                            <!-- Cards rendered by JS -->
                        </div>

                        <!-- Bulk Unreward Action Bar -->
                        <div id="received-bulk-bar"
                            class="hidden sticky bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-700 p-3 flex items-center justify-between gap-3 shadow-lg z-20 print:hidden">
                            <span id="received-selected-count"
                                class="text-sm font-bold text-gray-700 dark:text-gray-300">เลือก 0 รายการ</span>
                            <button onclick="bulkUnreward()"
                                class="flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-bold transition">
                                <i data-lucide="undo-2" class="w-4 h-4"></i>
                                คืนรายการที่เลือก
                            </button>
                        </div>
                    </div>

                </div>
            </div>
            <!-- VIEW 5: MY AWARDS (ผลงานของฉัน) -->
            <div id="view-my-awards"
                class="hidden flex flex-col h-full fixed inset-0 z-[45] bg-white dark:bg-slate-900 lg:absolute lg:inset-0 lg:top-16 lg:z-30 lg:bg-white dark:lg:bg-slate-900 fade-in overflow-hidden">
                <div class="flex flex-col h-full lg:max-w-[1200px] lg:mx-auto lg:w-full lg:px-8 lg:pt-6 relative">
                    <!-- Header -->
                    <div
                        class="p-4 border-b border-gray-100 bg-white dark:bg-slate-900 lg:bg-transparent lg:border-0 lg:p-0 lg:mb-4 shrink-0">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <button onclick="switchView('dashboard')"
                                    class="p-2 -ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 lg:hidden">
                                    <i data-lucide="arrow-left" class="w-6 h-6"></i>
                                </button>
                                <div>
                                    <h2 class="font-bold text-lg text-gray-800 dark:text-white">ผลงานของฉัน</h2>
                                    <p class="text-xs text-gray-400 dark:text-gray-500" id="my-awards-subtitle">
                                        รายการที่คุณเพิ่มเข้าระบบ</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Card -->
                    <div id="my-awards-profile"
                        class="mx-4 lg:mx-0 mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-slate-800 dark:to-slate-800 rounded-2xl border border-blue-100 dark:border-slate-700 shrink-0">
                        <div class="flex items-center gap-4">
                            <div id="my-awards-avatar"
                                class="w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-xl font-bold shadow-lg">
                                ?</div>
                            <div class="flex-1 min-w-0">
                                <p id="my-awards-name" class="text-lg font-bold text-gray-800 dark:text-white truncate">
                                    -</p>
                                <p id="my-awards-role" class="text-sm text-blue-600 dark:text-blue-400 font-medium">-
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-extrabold text-blue-600 dark:text-blue-400"
                                    id="my-awards-count">0</p>
                                <p class="text-xs text-gray-400">ผลงาน</p>
                            </div>
                        </div>
                    </div>

                    <!-- Search -->
                    <div class="px-4 lg:px-0 mb-3 shrink-0">
                        <div class="relative">
                            <i data-lucide="search"
                                class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                            <input type="text" id="my-awards-search" oninput="renderMyAwards()"
                                placeholder="ค้นหาผลงาน..."
                                class="w-full pl-9 pr-4 py-2.5 bg-gray-50 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-100 transition">
                        </div>
                    </div>

                    <!-- Awards List -->
                    <div class="flex-1 overflow-y-auto px-4 lg:px-0 pb-8">
                        <div id="my-awards-list" class="space-y-3">
                            <!-- Dynamic Content -->
                        </div>
                        <div id="no-my-awards"
                            class="hidden flex flex-col items-center justify-center py-20 text-gray-400">
                            <i data-lucide="folder-open" class="w-12 h-12 mb-3 text-gray-200"></i>
                            <p>ไม่พบผลงานของคุณ</p>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Edit Award Modal -->
    <div id="edit-award-modal" class="fixed inset-0 z-[70] hidden items-center justify-center p-4">
        <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm" onclick="closeModal('edit-award-modal')"></div>
        <div
            class="bg-white dark:bg-slate-900 w-full max-w-2xl rounded-2xl shadow-2xl relative z-10 flex flex-col max-h-[90vh] transform transition-transform duration-300 translate-y-full">
            <!-- Modal Header -->
            <div
                class="flex items-center justify-between p-5 border-b border-gray-100 dark:border-slate-800 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-slate-800 dark:to-slate-800 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center">
                        <i data-lucide="pencil" class="w-5 h-5 text-amber-600"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-900 dark:text-white">แก้ไขข้อมูลผลงาน</h3>
                        <p class="text-xs text-gray-400">แก้ไขรายละเอียดรางวัลและผู้เข้าร่วม</p>
                    </div>
                </div>
                <button onclick="closeModal('edit-award-modal')"
                    class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 text-gray-400 hover:text-gray-600 transition">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Warning Banner -->
            <div
                class="mx-5 mt-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800/40 rounded-xl p-3 flex items-start gap-2">
                <i data-lucide="alert-triangle" class="w-4 h-4 text-orange-500 mt-0.5 shrink-0"></i>
                <p class="text-xs text-orange-700 dark:text-orange-300">การแก้ไขข้อมูลต้องระบุ <strong>หมายเหตุ</strong>
                    ว่าแก้ไขอะไร เพื่อใช้เป็นหลักฐานในการตรวจสอบ</p>
            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-y-auto p-5 space-y-4">
                <input type="hidden" id="edit-award-id">

                <!-- Competition Name -->
                <div>
                    <label
                        class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">ชื่อรายการแข่งขัน</label>
                    <input type="text" id="edit-comp-name"
                        class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white focus:bg-white dark:focus:bg-slate-700 focus:ring-2 focus:ring-blue-100 outline-none transition text-sm">
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Rank -->
                    <div>
                        <label
                            class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">รางวัลที่ได้รับ</label>
                        <select id="edit-comp-rank"
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-100 outline-none text-sm">
                            <option value="">-- เลือกรางวัล --</option>
                            <option value="ชนะเลิศ">ชนะเลิศ</option>
                            <option value="รองชนะเลิศอันดับที่ 1">รองชนะเลิศอันดับที่ 1</option>
                            <option value="รองชนะเลิศอันดับที่ 2">รองชนะเลิศอันดับที่ 2</option>
                            <option value="รองชนะเลิศอันดับที่ 3">รองชนะเลิศอันดับที่ 3</option>
                            <option value="เหรียญทอง">เหรียญทอง</option>
                            <option value="เหรียญเงิน">เหรียญเงิน</option>
                            <option value="เหรียญทองแดง">เหรียญทองแดง</option>
                            <option value="ชมเชย">ชมเชย</option>
                            <option value="เข้าร่วม">เข้าร่วม</option>
                        </select>
                    </div>
                    <!-- Level -->
                    <div>
                        <label
                            class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">ระดับการแข่งขัน</label>
                        <select id="edit-comp-level"
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-100 outline-none text-sm">
                            <option value="">-- เลือกระดับ --</option>
                            <option value="ระดับโรงเรียน">ระดับโรงเรียน</option>
                            <option value="ระดับอำเภอ">ระดับอำเภอ</option>
                            <option value="ระดับเขตพื้นที่ฯ">ระดับเขตพื้นที่ฯ</option>
                            <option value="ระดับจังหวัด">ระดับจังหวัด</option>
                            <option value="ระดับภาค">ระดับภาค</option>
                            <option value="ระดับชาติ">ระดับชาติ</option>
                            <option value="ระดับนานาชาติ">ระดับนานาชาติ</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Organizer -->
                    <div>
                        <label
                            class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">หน่วยงานจัดแข่ง</label>
                        <input type="text" id="edit-comp-org"
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-100 outline-none text-sm">
                    </div>
                    <!-- Date -->
                    <div>
                        <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">วันที่ได้รับรางวัล
                            <span class="text-gray-400 font-normal">(ค.ศ.)</span></label>
                        <input type="date" id="edit-comp-date"
                            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-100 outline-none text-sm">
                    </div>
                </div>

                <!-- On Behalf Of (Multi-select dropdown) -->
                <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">ส่งรางวัลในนาม
                        (กลุ่มสาระฯ)</label>
                    <select id="edit-on-behalf-select" onchange="addEditOnBehalf()"
                        class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-100 outline-none text-sm cursor-pointer">
                        <option value="">-- เลือกกลุ่มสาระ (เลือกแล้วเพิ่มอัตโนมัติ) --</option>
                        <option value="ไม่มีกลุ่มสาระ">ไม่มีกลุ่มสาระ</option>
                        <option>กลุ่มสาระการเรียนรู้คณิตศาสตร์</option>
                        <option>กลุ่มสาระการเรียนรู้วิทยาศาสตร์และเทคโนโลยี</option>
                        <option>กลุ่มสาระการเรียนรู้ภาษาไทย</option>
                        <option>กลุ่มสาระการเรียนรู้ภาษาต่างประเทศ</option>
                        <option>กลุ่มสาระการเรียนรู้สังคมศึกษา ศาสนาและวัฒนธรรม</option>
                        <option>กลุ่มสาระการเรียนรู้สุขศึกษา พลศึกษา</option>
                        <option>กลุ่มสาระการเรียนรู้ศิลปะ</option>
                        <option>กลุ่มสาระการเรียนรู้การงานอาชีพ</option>
                    </select>
                    <div id="edit-on-behalf-chips" class="mt-2 flex flex-wrap gap-1.5"></div>
                </div>

                <!-- Department / กลุ่มงาน (Multi-select dropdown with อื่นๆ) -->
                <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">กลุ่มงาน /
                        กิจกรรม</label>
                    <select id="edit-dept-select" onchange="handleEditDeptChange()"
                        class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-100 outline-none text-sm cursor-pointer">
                        <option value="">-- เลือกกลุ่มงาน (เลือกแล้วเพิ่มอัตโนมัติ) --</option>
                        <option value="ไม่มีกลุ่มงาน">ไม่มีกลุ่มงาน</option>
                        <option>งานแนะแนว</option>
                        <option>งานเทคโนโลยี</option>
                        <option>กิจกรรมพัฒนาผู้เรียน (ลูกเสือ)</option>
                        <option>งานห้องเรียนพิเศษ SMTE</option>
                        <option>งานสภานักเรียน</option>
                        <option>งานห้องสมุด</option>
                        <option>งานห้องเรียนสีเขียว</option>
                        <option>งาน to be number one</option>
                        <option value="other">อื่นๆ (โปรดระบุ)</option>
                    </select>
                    <div id="edit-dept-other-container" class="hidden mt-2 flex gap-2">
                        <input type="text" id="edit-dept-other-input"
                            class="flex-1 px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-100 outline-none text-sm"
                            placeholder="พิมพ์ชื่อกลุ่มงาน...">
                        <button type="button" onclick="addEditDeptOther()"
                            class="px-4 py-2.5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl text-sm font-bold transition shrink-0 flex items-center gap-1">
                            <i data-lucide="plus" class="w-4 h-4"></i> เพิ่ม
                        </button>
                    </div>
                    <div id="edit-dept-chips" class="mt-2 flex flex-wrap gap-1.5"></div>
                </div>

                <!-- Students Section -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="text-xs font-bold text-gray-500 dark:text-gray-400 flex items-center gap-1">
                            <i data-lucide="users" class="w-3.5 h-3.5"></i> นักเรียน
                        </label>
                        <button type="button" onclick="addEditStudent()"
                            class="text-xs text-blue-600 hover:text-blue-800 font-bold flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-blue-50 transition">
                            <i data-lucide="plus-circle" class="w-3.5 h-3.5"></i> เพิ่มนักเรียน
                        </button>
                    </div>
                    <div id="edit-students-list" class="space-y-2 max-h-60 overflow-y-auto">
                        <!-- Dynamic student rows -->
                    </div>
                </div>

                <!-- Teachers Section -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="text-xs font-bold text-gray-500 dark:text-gray-400 flex items-center gap-1">
                            <i data-lucide="user-check" class="w-3.5 h-3.5"></i> ครูผู้ฝึกซ้อม
                        </label>
                        <button type="button" onclick="addEditTeacher()"
                            class="text-xs text-green-600 hover:text-green-800 font-bold flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-green-50 transition">
                            <i data-lucide="plus-circle" class="w-3.5 h-3.5"></i> เพิ่มครู
                        </button>
                    </div>
                    <div id="edit-teachers-list" class="space-y-2 max-h-60 overflow-y-auto">
                        <!-- Dynamic teacher rows -->
                    </div>
                </div>

                <!-- File Uploads -->
                <div>
                    <label
                        class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 flex items-center gap-1">
                        <i data-lucide="paperclip" class="w-3.5 h-3.5"></i> อัปโหลดไฟล์ (เปลี่ยนไฟล์ใหม่)
                    </label>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <!-- Certificate Upload -->
                        <div>
                            <p class="text-[10px] text-gray-500 dark:text-gray-400 mb-1 font-medium">1.
                                รูปภาพเกียรติบัตร / PDF</p>
                            <div class="file-upload-zone rounded-xl p-3 text-center cursor-pointer border-2 border-dashed border-gray-200 dark:border-slate-600 hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition"
                                onclick="document.getElementById('edit-evidence-cert').click()">
                                <input type="file" id="edit-evidence-cert" class="hidden" accept="image/*,.pdf"
                                    onchange="handleEditFileSelect(event, 'cert')">
                                <div id="edit-cert-placeholder" class="py-2">
                                    <i data-lucide="file-badge" class="w-6 h-6 mx-auto text-gray-400 mb-1"></i>
                                    <p class="text-[10px] text-blue-600 dark:text-blue-400 font-medium">
                                        แนบไฟล์เกียรติบัตร</p>
                                </div>
                                <div id="edit-cert-preview" class="hidden flex items-center justify-center gap-2 py-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    <span
                                        class="text-[10px] font-semibold text-gray-700 dark:text-gray-300 truncate max-w-[100px]"
                                        id="edit-cert-name">filename.pdf</span>
                                    <button type="button" onclick="clearEditFile(event, 'cert')"
                                        class="text-red-400 hover:text-red-600"><i data-lucide="x"
                                            class="w-3.5 h-3.5"></i></button>
                                </div>
                            </div>
                        </div>
                        <!-- Activity Photo Upload -->
                        <div>
                            <p class="text-[10px] text-gray-500 dark:text-gray-400 mb-1 font-medium">2. รูปภาพกิจกรรม /
                                รับรางวัล</p>
                            <div class="file-upload-zone rounded-xl p-3 text-center cursor-pointer border-2 border-dashed border-gray-200 dark:border-slate-600 hover:border-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition"
                                onclick="document.getElementById('edit-evidence-photo').click()">
                                <input type="file" id="edit-evidence-photo" class="hidden" accept="image/*"
                                    onchange="handleEditFileSelect(event, 'photo')">
                                <div id="edit-photo-placeholder" class="py-2">
                                    <i data-lucide="image" class="w-6 h-6 mx-auto text-gray-400 mb-1"></i>
                                    <p class="text-[10px] text-green-600 dark:text-green-400 font-medium">
                                        แนบรูปภาพกิจกรรม</p>
                                </div>
                                <div id="edit-photo-preview" class="hidden flex items-center justify-center gap-2 py-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    <span
                                        class="text-[10px] font-semibold text-gray-700 dark:text-gray-300 truncate max-w-[100px]"
                                        id="edit-photo-name">image.jpg</span>
                                    <button type="button" onclick="clearEditFile(event, 'photo')"
                                        class="text-red-400 hover:text-red-600"><i data-lucide="x"
                                            class="w-3.5 h-3.5"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes (Required) -->
                <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">หมายเหตุ
                        (ระบุสิ่งที่แก้ไข) <span class="text-red-500">*</span></label>
                    <textarea id="edit-notes" rows="3"
                        class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-100 outline-none text-sm resize-none"
                        placeholder="กรุณาระบุว่าแก้ไขอะไร เช่น แก้ไขชื่อนักเรียน, แก้ระดับรางวัล ฯลฯ"></textarea>
                    <p id="edit-notes-error" class="hidden text-xs text-red-500 mt-1">กรุณาระบุหมายเหตุว่าแก้ไขอะไร</p>
                </div>
            </div>

            <!-- Modal Footer -->
            <div
                class="p-4 border-t border-gray-100 dark:border-slate-800 flex items-center justify-between rounded-b-2xl bg-gray-50/50 dark:bg-slate-800/30">
                <button onclick="closeModal('edit-award-modal')"
                    class="px-5 py-2.5 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 text-gray-600 dark:text-gray-300 font-bold rounded-xl hover:bg-gray-50 transition text-sm">
                    ยกเลิก
                </button>
                <button onclick="submitEditAward()" id="edit-award-submit-btn"
                    class="px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition shadow-lg shadow-blue-200 text-sm flex items-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    บันทึกการแก้ไข
                </button>
            </div>
        </div>
    </div>

    <!-- Selection Action Bar (Sticky Bottom - Pending Rewards only) -->
    <div id="selection-action-bar"
        class="fixed bottom-0 left-0 right-0 p-4 bg-white/95 backdrop-blur shadow-[0_-4px_20px_-5px_rgba(0,0,0,0.1)] border-t border-gray-100 z-50 transform translate-y-full transition-transform duration-300 flex items-center justify-between lg:max-w-[1200px] lg:mx-auto lg:left-0 lg:right-0 print:hidden">
        <div class="flex items-center gap-3">
            <span class="text-sm font-medium text-gray-600">เลือกแล้ว <span id="selected-count"
                    class="text-blue-600 font-bold">0</span> รายการ</span>
            <button onclick="selectAllVisible()"
                class="text-xs text-blue-500 underline hover:text-blue-700">เลือกทั้งหมด</button>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="executeBulkAction('reject')"
                class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-bold transition flex items-center gap-2">
                <i data-lucide="x-circle" class="w-4 h-4"></i>
                <span class="hidden sm:inline">ไม่รับ/ซ่อน</span>
            </button>
            <button onclick="executeBulkAction('receive')"
                class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-bold transition shadow-lg shadow-green-200 flex items-center gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4"></i>
                <span>ยืนยันรับรางวัล</span>
            </button>
        </div>
    </div>

    <!-- Undo Toast -->
    <div id="undo-toast"
        class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[100] hidden transform transition-all duration-300 translate-y-4 opacity-0">
        <div
            class="flex items-center gap-3 bg-gray-900 text-white rounded-xl shadow-2xl px-5 py-3.5 min-w-[320px] max-w-[480px]">
            <i data-lucide="info" class="w-5 h-5 text-blue-400 shrink-0"></i>
            <div class="flex-1 min-w-0">
                <p id="undo-toast-msg" class="text-sm font-medium truncate">ย้ายรายการไปรับแล้ว</p>
                <div class="w-full bg-gray-700 rounded-full h-1 mt-2">
                    <div id="undo-toast-progress" class="bg-blue-400 h-1 rounded-full transition-all duration-100"
                        style="width:100%"></div>
                </div>
            </div>
            <button id="undo-toast-btn" onclick="executeUndo()"
                class="shrink-0 px-3.5 py-1.5 bg-amber-500 hover:bg-amber-400 text-white rounded-lg text-sm font-bold transition flex items-center gap-1.5">
                <i data-lucide="undo-2" class="w-3.5 h-3.5"></i>
                เลิกทำ
            </button>
            <button onclick="dismissUndoToast()" class="shrink-0 p-1 hover:bg-gray-700 rounded-lg transition">
                <i data-lucide="x" class="w-4 h-4 text-gray-400"></i>
            </button>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
        <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity"
            onclick="closeModal('detail-modal')"></div>
        <div
            class="bg-white dark:bg-slate-900 w-full max-w-2xl rounded-2xl shadow-2xl relative z-10 flex flex-col max-h-[90vh] transform transition-transform duration-300 translate-y-full">
            <!-- Modal Header -->
            <div
                class="flex items-start justify-between p-6 border-b border-gray-100 dark:border-slate-800 bg-gradient-to-br from-blue-50/80 via-white to-purple-50/50 dark:from-slate-800/80 dark:via-slate-900 dark:to-slate-800/50 rounded-t-2xl">
                <div class="flex-1 min-w-0">
                    <div class="flex flex-wrap items-center gap-2 mb-3">
                        <span id="detail-rank-badge"
                            class="px-3 py-1 rounded-full text-xs font-bold bg-yellow-100 text-yellow-800 ring-1 ring-yellow-200/50">รางวัล</span>
                        <span id="detail-level-badge"
                            class="px-3 py-1 rounded-full text-xs font-bold bg-purple-100 text-purple-700 ring-1 ring-purple-200/50">ระดับ</span>
                    </div>
                    <h3 id="detail-title" class="text-xl font-bold text-gray-900 dark:text-white leading-tight mb-1">
                        ชื่อรายการแข่งขัน</h3>
                    <div class="flex items-center gap-2 text-xs text-gray-400 dark:text-gray-500 mt-2">
                        <i data-lucide="calendar" class="w-3.5 h-3.5"></i>
                        <span id="detail-date">-</span>
                    </div>
                </div>
                <button onclick="closeModal('detail-modal')"
                    class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 text-gray-400 hover:text-gray-600 transition shrink-0 ml-3">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Modal Body (Scrollable) -->
            <div class="flex-1 overflow-y-auto p-6 space-y-5">
                <!-- Organization Info Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <div
                        class="bg-blue-50/70 dark:bg-slate-800 rounded-xl p-3 border border-blue-100/50 dark:border-slate-700">
                        <p class="text-[10px] font-bold text-blue-400 dark:text-blue-500 uppercase tracking-wider mb-1">
                            กลุ่มสาระ</p>
                        <p id="detail-subject-group"
                            class="text-sm font-semibold text-gray-800 dark:text-gray-200 leading-snug">-</p>
                    </div>
                    <div id="detail-work-group-card"
                        class="bg-indigo-50/70 dark:bg-slate-800 rounded-xl p-3 border border-indigo-100/50 dark:border-slate-700">
                        <p
                            class="text-[10px] font-bold text-indigo-400 dark:text-indigo-500 uppercase tracking-wider mb-1">
                            กลุ่มงาน</p>
                        <p id="detail-work-group"
                            class="text-sm font-semibold text-gray-800 dark:text-gray-200 leading-snug">-</p>
                    </div>
                    <div
                        class="bg-gray-50/70 dark:bg-slate-800 rounded-xl p-3 border border-gray-100/50 dark:border-slate-700">
                        <p class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-1">
                            หน่วยงานที่จัด</p>
                        <p id="detail-organizer"
                            class="text-sm font-semibold text-gray-800 dark:text-gray-200 leading-snug">-</p>
                    </div>
                </div>

                <!-- Evidence Section -->
                <div
                    class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 bg-gray-50/50 dark:bg-slate-800/50 rounded-xl p-3 border border-gray-100 dark:border-slate-700">
                    <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
                        <i data-lucide="paperclip" class="w-4 h-4"></i>
                        <span class="font-medium">หลักฐาน/ไฟล์แนบ</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div id="evidence-actions" class="hidden gap-2">
                            <a id="detail-link-btn" href="#" target="_blank"
                                class="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm font-bold hover:bg-blue-100 transition">
                                <i data-lucide="external-link" class="w-4 h-4"></i>
                                ดูหลักฐาน
                            </a>
                            <button id="detail-preview-btn" onclick="togglePreview()"
                                class="inline-flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-bold hover:bg-gray-200 transition hidden">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                                ตัวอย่าง
                            </button>
                        </div>
                        <span id="detail-no-link" class="text-sm text-gray-400 italic hidden">ไม่มีไฟล์แนบ</span>
                    </div>
                </div>

                <!-- Preview Container -->
                <div id="preview-container"
                    class="hidden border rounded-xl overflow-hidden bg-gray-100 h-64 md:h-80 relative">
                    <iframe id="preview-frame" class="w-full h-full" allow="autoplay"></iframe>
                </div>

                <!-- Participants Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Students -->
                    <div>
                        <div class="flex items-center gap-2 mb-3">
                            <h4 class="font-bold text-gray-800 dark:text-white">นักเรียน</h4>
                            <span id="detail-std-count"
                                class="bg-gray-100 dark:bg-slate-800 text-gray-600 dark:text-gray-300 text-xs px-2 py-0.5 rounded-full font-bold">0</span>
                        </div>
                        <div id="detail-std-list" class="space-y-2 max-h-48 overflow-y-auto pr-1 custom-scrollbar">
                            <!-- Dynamic List -->
                        </div>
                    </div>

                    <!-- Teachers -->
                    <div>
                        <div class="flex items-center gap-2 mb-3">
                            <h4 class="font-bold text-gray-800 dark:text-white">ครูผู้ฝึกซ้อม</h4>
                            <span id="detail-tch-count"
                                class="bg-gray-100 dark:bg-slate-800 text-gray-600 dark:text-gray-300 text-xs px-2 py-0.5 rounded-full font-bold">0</span>
                        </div>
                        <div id="detail-tch-list" class="space-y-2 max-h-48 overflow-y-auto pr-1 custom-scrollbar">
                            <!-- Dynamic List -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal Footer -->
            <div
                class="p-4 border-t border-gray-100 dark:border-slate-800 bg-gray-50/30 dark:bg-slate-800/30 flex justify-end rounded-b-2xl">
                <button onclick="closeModal('detail-modal')"
                    class="px-6 py-2 bg-white border border-gray-200 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition shadow-sm">ปิด</button>
            </div>
        </div>
    </div>

    <!-- Student Modal (Add/Edit) -->
    <div id="student-modal" class="fixed inset-0 z-[60] hidden items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity"
            onclick="closeModal('student-modal')"></div>
        <div
            class="bg-white dark:bg-slate-900 rounded-2xl shadow-xl w-full max-w-md relative z-10 transform transition-transform duration-300 translate-y-full flex flex-col max-h-[90vh]">
            <div class="p-5 border-b border-gray-100 dark:border-slate-800 flex justify-between items-center">
                <h3 class="font-bold text-lg text-gray-800 dark:text-white">เพิ่มข้อมูลนักเรียน</h3>
                <button onclick="closeModal('student-modal')"
                    class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-5 space-y-4 overflow-y-auto">
                <div>
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">คำนำหน้า</label>
                    <select id="std-title"
                        class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none">
                        <option>ด.ช.</option>
                        <option>ด.ญ.</option>
                        <option>นาย</option>
                        <option>นางสาว</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">ชื่อ</label>
                        <input type="text" id="std-firstname"
                            class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none"
                            placeholder="ชื่อจริง">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">นามสกุล</label>
                        <input type="text" id="std-lastname"
                            class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none"
                            placeholder="นามสกุล">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">ระดับชั้น</label>
                        <select id="std-grade" onchange=""
                            class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none">
                            <option>ม.1</option>
                            <option>ม.2</option>
                            <option>ม.3</option>
                            <option>ม.4</option>
                            <option>ม.5</option>
                            <option>ม.6</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">ห้อง</label>
                        <select id="std-room"
                            class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/30 p-3 rounded-lg flex items-start gap-2">
                    <i data-lucide="info" class="w-4 h-4 text-blue-500 dark:text-blue-400 mt-0.5 shrink-0"></i>
                    <p class="text-xs text-blue-600 dark:text-blue-300">กรณีเป็นนักเรียนที่จบการศึกษาแล้ว
                        ให้เลือกระดับชั้นตามปีการศึกษาที่ได้รับรางวัล</p>
                </div>

                <button onclick="saveStudent()"
                    class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold mt-2 hover:bg-blue-700 transition">ยืนยัน</button>
            </div>
        </div>
    </div>

    <!-- Teacher Modal (Add/Edit) -->
    <div id="teacher-modal" class="fixed inset-0 z-[60] hidden items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity"
            onclick="closeModal('teacher-modal')"></div>
        <div
            class="bg-white dark:bg-slate-900 rounded-2xl shadow-xl w-full max-w-md relative z-10 transform transition-transform duration-300 translate-y-full flex flex-col">
            <div class="p-5 border-b border-gray-100 dark:border-slate-800 flex justify-between items-center">
                <h3 class="font-bold text-lg text-gray-800 dark:text-white">เพิ่มข้อมูลครู</h3>
                <button onclick="closeModal('teacher-modal')"
                    class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">คำนำหน้า</label>
                    <select id="tch-title"
                        class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none">
                        <option>นาย</option>
                        <option>นาง</option>
                        <option>นางสาว</option>
                        <option>ว่าที่ร้อยตรี</option>
                        <option>ดร.</option>
                        <option value="other">อื่น ๆ (ระบุ)</option>
                    </select>
                    <input type="text" id="tch-title-other"
                        class="mt-2 w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 dark:text-white outline-none hidden fade-in text-sm"
                        placeholder="ระบุคำนำหน้าชื่อ...">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">ชื่อ</label>
                        <input type="text" id="tch-firstname"
                            class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none"
                            placeholder="ชื่อ">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">นามสกุล</label>
                        <input type="text" id="tch-lastname"
                            class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none"
                            placeholder="นามสกุล">
                    </div>
                </div>
                <div class="mt-3">
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">กลุ่มสาระการเรียนรู้
                        / งาน <span class="text-red-500">*</span></label>
                    <select id="tch-dept"
                        class="w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 dark:text-white outline-none text-sm">
                        <option value="">-- เลือกกลุ่มสาระ --</option>
                        <option>กลุ่มสาระการเรียนรู้คณิตศาสตร์</option>
                        <option>กลุ่มสาระการเรียนรู้วิทยาศาสตร์และเทคโนโลยี</option>
                        <option>กลุ่มสาระการเรียนรู้ภาษาไทย</option>
                        <option>กลุ่มสาระการเรียนรู้ภาษาต่างประเทศ</option>
                        <option>กลุ่มสาระการเรียนรู้สังคมศึกษา ศาสนาและวัฒนธรรม</option>
                        <option>กลุ่มสาระการเรียนรู้สุขศึกษา พลศึกษา</option>
                        <option>กลุ่มสาระการเรียนรู้ศิลปะ</option>
                        <option>กลุ่มสาระการเรียนรู้การงานอาชีพ</option>
                        <option>กิจกรรมพัฒนาผู้เรียน (ลูกเสือ)</option>
                        <option>งานแนะแนว</option>
                        <option>งานเทคโนโลยี</option>
                        <option>งานสภานักเรียน</option>
                        <option>งานห้องสมุด</option>
                        <option>งานห้องเรียนสีเขียว</option>
                        <option>งาน to be number one</option>
                        <option value="other">อื่นๆ (โปรดระบุ)</option>
                    </select>
                    <input type="text" id="tch-dept-other"
                        class="mt-2 w-full px-3 py-3 rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 dark:text-white outline-none hidden text-sm"
                        placeholder="ระบุชื่อกลุ่มสาระ/งาน...">
                </div>
                <div class="pt-2">
                    <button onclick="saveTeacher()"
                        class="w-full py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition shadow-lg shadow-green-100 dark:shadow-none">ยืนยันข้อมูล</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading"
        class="fixed inset-0 z-[10000] bg-black/50 backdrop-blur-sm flex items-center justify-center invisible transition-all duration-300">
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-2xl flex flex-col items-center">
            <div
                class="w-12 h-12 border-4 border-blue-100 dark:border-slate-700 border-t-blue-600 rounded-full animate-spin mb-4">
            </div>
            <p class="text-gray-800 dark:text-white font-bold text-lg">กำลังบันทึกข้อมูล...</p>
            <p class="text-gray-500 dark:text-gray-400 text-sm">กรุณารอสักครู่</p>
        </div>
    </div>
    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity"
            onclick="closeModal('login-modal')"></div>
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-slate-900 rounded-2xl shadow-xl w-full max-w-sm p-6 transform transition-all scale-100 opacity-100">
            <div class="text-center mb-6">
                <div
                    class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i data-lucide="lock" class="w-6 h-6"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 dark:text-white">เข้าสู่ระบบ</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">กรุณาเข้าสู่ระบบเพื่อจัดการข้อมูล</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label
                        class="block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-1">ชื่อผู้ใช้งาน</label>
                    <input type="text" id="login-username" placeholder="Username"
                        class="w-full px-4 py-2.5 bg-gray-50 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl text-sm focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 dark:focus:border-blue-500 outline-none transition dark:text-white">
                </div>
                <div>
                    <label
                        class="block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-1">รหัสผ่าน</label>
                    <input type="password" id="login-password" placeholder="Password"
                        class="w-full px-4 py-2.5 bg-gray-50 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl text-sm focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 dark:focus:border-blue-500 outline-none transition dark:text-white">
                </div>
                <button onclick="doLogin()" id="btn-login-submit"
                    class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition flex items-center justify-center gap-2">
                    <span>เข้าสู่ระบบ</span>
                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
                <div class="text-center mt-3">
                    <button type="button" onclick="closeModal('login-modal'); openModal('forgot-password-modal')"
                        class="text-xs text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 hover:underline transition">
                        ลืมรหัสผ่าน?
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity"
            onclick="closeModal('forgot-password-modal')"></div>
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-slate-900 rounded-2xl shadow-xl w-full max-w-sm p-6 transform transition-all scale-100 opacity-100">
            <div class="text-center mb-6">
                <div
                    class="w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i data-lucide="key-round" class="w-6 h-6"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 dark:text-white">ลืมรหัสผ่าน</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">กรอกชื่อผู้ใช้งานเพื่อรีเซ็ตรหัสผ่าน</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label
                        class="block text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-1">ชื่อผู้ใช้งาน</label>
                    <input type="text" id="forgot-username" placeholder="Username"
                        class="w-full px-4 py-2.5 bg-gray-50 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl text-sm focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 dark:focus:border-blue-500 outline-none transition dark:text-white">
                </div>
                <button onclick="doResetPassword()" id="btn-forgot-submit"
                    class="w-full py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-bold transition flex items-center justify-center gap-2">
                    <span>รีเซ็ตรหัสผ่าน</span>
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
                <div class="text-center">
                    <button type="button" onclick="closeModal('forgot-password-modal'); openModal('login-modal')"
                        class="text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 hover:underline transition">
                        กลับไปหน้าเข้าสู่ระบบ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js?v=3"></script>
</body>

</html>